import json
import os
from balldontlie import BalldontlieAPI
from dotenv import load_dotenv

# Only load .env if it exists
if os.path.exists(".env"):
    load_dotenv()

# Fetch the API key from environment
api_key = os.getenv("BALLDONTLIEAPI_KEY")
if not api_key:
    raise ValueError(
        "BALLDONTLIEAPI_KEY not set. "
        "Set it in a local .env file or as a GitHub Actions secret."
    )

# Initialise the API
api = BalldontlieAPI(api_key=api_key)

# Fetch NFL teams data
data = api.nfl.teams.list()

# Convert each team to a dictionary using Pydantic v2+ `.model_dump()`
team_data = [team.model_dump() for team in data.data]

# Write the data to a TypeScript file
with open("scripts/team-data.ts", "w") as f:
    f.write("// file generated by fetch-qb-data.py\n")
    f.write("\n")
    f.write("export const teamData = ")
    json.dump(team_data, f, indent=2)
    f.write("\n")
